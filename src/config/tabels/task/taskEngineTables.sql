/* SCHEDULER TASKS */

create table if not exists TASK (
	TASK_ID BIGINT NOT NULL,
	TASK_NAME VARCHAR(200) NOT NULL ,
	TASK_DESCRIPTION VARCHAR(200) NULL,
	TASK_EXECUTE VARCHAR(500) NOT NULL,
	CREATED_TIME BIGINT NOT NULL, 
	UPDATED_TIME BIGINT NOT NULL,
	TASK_PRIORITY INT NOT NULL ,
	TASK_STATUS INT NOT NULL ,

    constraint TASK_PK PRIMARY KEY (TASK_ID)
);

create table if not exists SCHEDULE(
	SCHEDULE_ID BIGINT NOT NULL,
	START_TIME BIGINT NOT NULL,
	END_TIME BIGINT NOT NULL,
	IS_RECURING INT NOT NULL ,
	NEXT_RECURING_TIME  BIGINT  NULL,
	LAST_RUNNED_TIME BIGINT NOT NULL,
	EXCECUTED_STATUS BIGINT NOT NULL ,
	CREATED_TIME BIGINT NOT NULL, 
	UPDATED_TIME BIGINT NOT NULL,

    constraint SCHEDULER_PK PRIMARY KEY (SCHEDULE_ID)
);


create table if not exists SCEDULE_EXCECUTED_TIMINIG(
	SCEDULE_TIMING_ID BIGINT NOT NULL ,
	START_TIME BIGINT NOT NULL,
	END_TIME BIGINT NOT NULL
);

create table if not exists TASK_SCHEDULE_MAP (
	TASK_ID BIGINT NOT NULL,
	SCHEDULE_ID BIGINT NOT NULL,
	
	constraint TASK_SCHEDULE_MAP_PK PRIMARY KEY (TASK_ID , SCHEDULE_ID) , 
	constraint TASK_SCHEDULE_MAP_FK1 FOREIGN KEY ( TASK_ID ) references TASK( TASK_ID ),
	constraint TASK_SCHEDULE_MAP_FK2 FOREIGN KEY ( SCHEDULE_ID ) references SCHEDULE( SCHEDULE_ID )

);

create table if not exists RECCURRING_TASK (
	RECCURRING_TASK_ID int NOT NULL,
	RECCURRING_TASK int NOT NULL, 
	RECCURRING_TASK_DESCRIPTION VARCHAR(200) NULL,

	constraint RECCURRING_TASK_PK PRIMARY KEY ( RECCURRING_TASK_ID ) 

);

create table if not exists RECCURRING_TASK_CONFIG (
	RECCURRING_TASK_CONFIG_ID BIGINT NOT NULL,
	RECCURRING_TASK_ID int NOT NULL, 
	RECCURRING_RUN_TYPE int NOT NULL, 
	RECCURRING_RUN_FREQUENCY int NOT NULL, 
	RECCURRING_TASK_DESCRIPTION VARCHAR(200) NULL,

	constraint RECCURRING_TASK_PERIOD_PK PRIMARY KEY ( RECCURRING_TASK_CONFIG_ID ) 

);

create table if not exists TASK_START_CONFIG (
	TASK_ID BIGINT NOT NULL,
	TASK_START_CONFIG_ID BIGINT NOT NULL, 
	YEAR int NOT NULL, 
	MONTH int NOT NULL, 
	DAY int NOT NULL, 
	HOUR int NOT NULL, 
	MINUTE int NOT NULL, 
	SECOND int NOT NULL, 

	constraint TASK_START_CONFIG_PK PRIMARY KEY ( TASK_ID , TASK_START_CONFIG_ID ) ,
	constraint TASK_START_CONFIG_FK1 FOREIGN KEY ( TASK_ID ) references TASK( TASK_ID ) 

);

create table if not exists TASK_END_CONFIG (
	TASK_ID BIGINT NOT NULL,
	TASK_END_CONFIG_ID BIGINT NOT NULL, 
	YEAR int NOT NULL, 
	MONTH int NOT NULL, 
	DAY int NOT NULL, 
	HOUR int NOT NULL, 
	MINUTE int NOT NULL, 
	SECOND int NOT NULL, 

	constraint TASK_END_CONFIG_PK PRIMARY KEY ( TASK_ID , TASK_END_CONFIG_ID ) ,
	constraint TASK_END_CONFIG_FK1 FOREIGN KEY ( TASK_ID ) references TASK( TASK_ID ) 

);

create table if not exists TASK_RUN_CONFIG (
	TASK_ID BIGINT NOT NULL,
	TASK_RUN_CONFIG_ID BIGINT NOT NULL,
	HOUR INT NOT NULL, 
	MINUTE INT NOT NULL, 
	SECOND INT NOT NULL, 

	constraint TASK_RUN_CONFIG_PK PRIMARY KEY ( TASK_ID , TASK_RUN_CONFIG_ID ) ,
	constraint TASK_RUN_CONFIG_FK1 FOREIGN KEY ( TASK_ID ) references TASK( TASK_ID ) 

);

create table if not exists TASK_CONFIG (
	TASK_ID BIGINT NOT NULL,
	TASK_CONFIG_ID BIGINT NOT NULL, 
	TASK_START_CONFIG_ID BIGINT  NULL, 
	TASK_RUN_CONFIG_ID BIGINT  NULL, 
	TASK_END_CONFIG_ID BIGINT  NULL, 
	RECCURRING_TASK_CONFIG_ID BIGINT  NULL, 
	CUSTOM_DAY INT NULL ,
	TASK_CONFIG_STATUS INT NOT NULL, 
	
	constraint TASK_CONFIG_PK PRIMARY KEY ( TASK_ID , TASK_CONFIG_ID) ,
	constraint TASK_CONFIG_FK1 FOREIGN KEY ( TASK_ID , TASK_START_CONFIG_ID  ) references TASK_START_CONFIG( TASK_ID , TASK_START_CONFIG_ID ) ,
	constraint TASK_CONFIG_FK2 FOREIGN KEY ( TASK_ID , TASK_RUN_CONFIG_ID  ) references TASK_RUN_CONFIG( TASK_ID , TASK_RUN_CONFIG_ID ) ,
	constraint TASK_CONFIG_FK3 FOREIGN KEY ( TASK_ID , TASK_END_CONFIG_ID ) references TASK_END_CONFIG( TASK_ID , TASK_END_CONFIG_ID)  ,
	constraint TASK_CONFIG_FK4 FOREIGN KEY ( RECCURRING_TASK_CONFIG_ID ) references RECCURRING_TASK_CONFIG(  RECCURRING_TASK_CONFIG_ID)
);